{"version":3,"file":"batch.js","sources":["batch.es6.js"],"sourcesContent":["/**\n * @file\n * Drupal's batch API.\n */\n\n(($, Drupal) => {\n  /**\n   * Attaches the batch behavior to progress bars.\n   *\n   * @type {Drupal~behavior}\n   */\n  Drupal.behaviors.batch = {\n    attach(context, settings) {\n      const batch = settings.batch;\n      const $progress = $('[data-drupal-progress]').once('batch');\n      let progressBar;\n\n      // Success: redirect to the summary.\n      const updateCallback = (progress, status, pb) => {\n        if (progress === '100') {\n          pb.stopMonitoring();\n          window.location = `${batch.uri}&op=finished`;\n        }\n      };\n\n      const errorCallback = () => {\n        $progress.prepend($('<p class=\"error\"></p>').html(batch.errorMessage));\n        $('#wait').hide();\n      };\n\n      if ($progress.length) {\n        progressBar = new Drupal.ProgressBar('updateprogress', updateCallback, 'POST', errorCallback);\n        progressBar.setProgress(-1, batch.initMessage);\n        progressBar.startMonitoring(`${batch.uri}&op=do`, 10);\n        // Remove HTML from no-js progress bar.\n        $progress.empty();\n        // Append the JS progressbar element.\n        $progress.append(progressBar.element);\n      }\n    }\n  };\n})(jQuery, Drupal);\n"],"names":["behaviors","batch","settings","$progress","$","once","progressBar","length","Drupal","ProgressBar","progress","stopMonitoring","location","uri","prepend","html","errorMessage","hide","setProgress","initMessage","startMonitoring","empty","append","element","jQuery"],"mappings":"yBAKA,CAAC,aAAe,GAMPA,UAAUC,MAAQ,qBACG,IAClBA,GAAQC,EAASD,MACjBE,EAAYC,EAAE,wBAAFA,EAA4BC,IAA5BD,CAAiC,OAAjCA,EACdE,EAeAH,EAAUI,MAlBU,KAmBR,GAAIC,GAAOC,WAAX,CAAuB,gBAAvB,CAbO,eAA0B,CAC9B,KAAbC,IAD2C,KAE1CC,gBAF0C,QAGtCC,SAAcX,EAAMY,GAANZ,eAHwB,CAAjD,CAagB,CAAyD,MAAzD,CANM,UAAM,GAChBa,QAAQV,EAAE,uBAAFA,EAA2BW,IAA3BX,CAAgCH,EAAMe,YAAtCZ,EADQ,GAExB,SAASa,MAFb,CAMgB,CAnBQ,GAoBVC,YAAY,CAAC,EAAGjB,EAAMkB,YApBZ,GAqBVC,gBAAmBnB,EAAMY,GAANZ,UAAmB,GArB5B,GAuBZoB,OAvBY,GAyBZC,OAAOhB,EAAYiB,QAzBP,EADH,CAN3B,CAAA,EAoCGC,MApCH,CAoCWhB,MApCX"}