{"version":3,"file":"collapse.js","sources":["collapse.es6.js"],"sourcesContent":["/**\n * @file\n * Polyfill for HTML5 details elements.\n */\n\n(($, Modernizr, Drupal) => {\n  /**\n   * The collapsible details object represents a single details element.\n   *\n   * @constructor Drupal.CollapsibleDetails\n   *\n   * @param {HTMLElement} node\n   *   The details element.\n   */\n  function CollapsibleDetails(node) {\n    this.$node = $(node);\n    this.$node.data('details', this);\n    // Expand details if there are errors inside, or if it contains an\n    // element that is targeted by the URI fragment identifier.\n    const anchor = location.hash && location.hash !== '#' ? `, ${location.hash}` : '';\n    if (this.$node.find(`.error${anchor}`).length) {\n      this.$node.attr('open', true);\n    }\n    // Initialize and setup the summary,\n    this.setupSummary();\n    // Initialize and setup the legend.\n    this.setupLegend();\n  }\n\n  $.extend(CollapsibleDetails, /** @lends Drupal.CollapsibleDetails */{\n\n    /**\n     * Holds references to instantiated CollapsibleDetails objects.\n     *\n     * @type {Array.<Drupal.CollapsibleDetails>}\n     */\n    instances: [],\n  });\n\n  $.extend(CollapsibleDetails.prototype, /** @lends Drupal.CollapsibleDetails# */{\n\n    /**\n     * Initialize and setup summary events and markup.\n     *\n     * @fires event:summaryUpdated\n     *\n     * @listens event:summaryUpdated\n     */\n    setupSummary() {\n      this.$summary = $('<span class=\"summary\"></span>');\n      this.$node\n        .on('summaryUpdated', $.proxy(this.onSummaryUpdated, this))\n        .trigger('summaryUpdated');\n    },\n\n    /**\n     * Initialize and setup legend markup.\n     */\n    setupLegend() {\n      // Turn the summary into a clickable link.\n      const $legend = this.$node.find('> summary');\n\n      $('<span class=\"details-summary-prefix visually-hidden\"></span>')\n        .append(this.$node.attr('open') ? Drupal.t('Hide') : Drupal.t('Show'))\n        .prependTo($legend)\n        .after(document.createTextNode(' '));\n\n      // .wrapInner() does not retain bound events.\n      $('<a class=\"details-title\"></a>')\n        .attr('href', `#${this.$node.attr('id')}`)\n        .prepend($legend.contents())\n        .appendTo($legend);\n\n      $legend\n        .append(this.$summary)\n        .on('click', $.proxy(this.onLegendClick, this));\n    },\n\n    /**\n     * Handle legend clicks.\n     *\n     * @param {jQuery.Event} e\n     *   The event triggered.\n     */\n    onLegendClick(e) {\n      this.toggle();\n      e.preventDefault();\n    },\n\n    /**\n     * Update summary.\n     */\n    onSummaryUpdated() {\n      const text = $.trim(this.$node.drupalGetSummary());\n      this.$summary.html(text ? ` (${text})` : '');\n    },\n\n    /**\n     * Toggle the visibility of a details element using smooth animations.\n     */\n    toggle() {\n      const isOpen = !!this.$node.attr('open');\n      const $summaryPrefix = this.$node.find('> summary span.details-summary-prefix');\n      if (isOpen) {\n        $summaryPrefix.html(Drupal.t('Show'));\n      }\n      else {\n        $summaryPrefix.html(Drupal.t('Hide'));\n      }\n      // Delay setting the attribute to emulate chrome behavior and make\n      // details-aria.js work as expected with this polyfill.\n      setTimeout(() => {\n        this.$node.attr('open', !isOpen);\n      }, 0);\n    },\n  });\n\n  /**\n   * Polyfill HTML5 details element.\n   *\n   * @type {Drupal~behavior}\n   *\n   * @prop {Drupal~behaviorAttach} attach\n   *   Attaches behavior for the details element.\n   */\n  Drupal.behaviors.collapse = {\n    attach(context) {\n      if (Modernizr.details) {\n        return;\n      }\n      const $collapsibleDetails = $(context).find('details').once('collapse').addClass('collapse-processed');\n      if ($collapsibleDetails.length) {\n        for (let i = 0; i < $collapsibleDetails.length; i++) {\n          CollapsibleDetails.instances.push(new CollapsibleDetails($collapsibleDetails[i]));\n        }\n      }\n    },\n  };\n\n  // Expose constructor in the public space.\n  Drupal.CollapsibleDetails = CollapsibleDetails;\n})(jQuery, Modernizr, Drupal);\n"],"names":["$node","$","node","data","anchor","location","hash","find","length","attr","setupSummary","setupLegend","extend","CollapsibleDetails","prototype","$summary","on","proxy","onSummaryUpdated","trigger","$legend","append","Drupal","t","prependTo","after","document","createTextNode","prepend","contents","appendTo","onLegendClick","toggle","preventDefault","text","trim","drupalGetSummary","html","isOpen","$summaryPrefix","behaviors","collapse","Modernizr","details","$collapsibleDetails","context","once","addClass","i","instances","push","jQuery"],"mappings":"yBAKA,CAAC,eAA0B,cASS,MAC3BA,MAAQC,EAAEC,CAAFD,CADmB,MAE3BD,MAAMG,KAAK,UAAW,KAFK,IAK1BC,GAASC,SAASC,IAATD,EAAmC,GAAlBA,YAASC,IAA1BD,MAA8CA,SAASC,IAAvDD,CAAgE,GAC3E,KAAKL,KAAL,CAAWO,IAAX,UAAyBH,CAAzB,EAAmCI,MANP,OAOzBR,MAAMS,KAAK,UAPc,MAU3BC,cAV2B,MAY3BC,gBAGLC,OAAOC,EAA2D,aAAA,EAxB3C,GAkCvBD,OAAOC,EAAmBC,UAAmD,wBAS9D,MACRC,SAAWd,EAAE,+BAAFA,CADH,MAERD,MACFgB,GAAG,iBAAkBf,EAAEgB,KAAFhB,CAAQ,KAAKiB,gBAAbjB,CAA+B,IAA/BA,GACrBkB,QAAQ,iBAbgE,CAAA,uBAmB/D,IAENC,GAAU,KAAKpB,KAAL,CAAWO,IAAX,CAAgB,WAAhB,IAEd,gEACCc,OAAO,KAAKrB,KAAL,CAAWS,IAAX,CAAgB,MAAhB,EAA0Ba,EAAOC,CAAPD,CAAS,MAATA,CAA1B,CAA6CA,EAAOC,CAAPD,CAAS,MAATA,GACpDE,UAAUJ,GACVK,MAAMC,SAASC,cAATD,CAAwB,GAAxBA,EAPG,GAUV,iCACCjB,KAAK,WAAY,KAAKT,KAAL,CAAWS,IAAX,CAAgB,IAAhB,GACjBmB,QAAQR,EAAQS,QAART,IACRU,SAASV,EAbA,GAgBTC,OAAO,KAAKN,UACZC,GAAG,QAASf,EAAEgB,KAAFhB,CAAQ,KAAK8B,aAAb9B,CAA4B,IAA5BA,EApC4D,CAAA,0BA6C5D,MACV+B,QADU,GAEbC,gBA/CyE,CAAA,4BAqD1D,IACXC,GAAOjC,EAAEkC,IAAFlC,CAAO,KAAKD,KAAL,CAAWoC,gBAAX,EAAPnC,OACRc,SAASsB,KAAKH,OAAYA,KAAZA,CAAsB,GAvDkC,CAAA,kBA6DpE,YACDI,EAAS,CAAC,CAAC,KAAKtC,KAAL,CAAWS,IAAX,CAAgB,MAAhB,EACX8B,EAAiB,KAAKvC,KAAL,CAAWO,IAAX,CAAgB,uCAAhB,EACnB+B,CAHG,GAIUD,KAAKf,EAAOC,CAAPD,CAAS,MAATA,EAJf,GAOUe,KAAKf,EAAOC,CAAPD,CAAS,MAATA,EAPf,YAWI,UAAM,GACVtB,MAAMS,KAAK,OAAQ,CAAC6B,EAD3B,EAEG,GA1EwE,EAlCtD,GAwHlBE,UAAUC,SAAW,mBACV,KACVC,EAAUC,YAGRC,GAAsB3C,EAAE4C,CAAF5C,EAAWM,IAAXN,CAAgB,SAAhBA,EAA2B6C,IAA3B7C,CAAgC,UAAhCA,EAA4C8C,QAA5C9C,CAAqD,oBAArDA,KACxB2C,EAAoBpC,WACjB,GAAIwC,GAAI,EAAGA,EAAIJ,EAAoBpC,OAAQwC,MAC3BC,UAAUC,KAAK,GAAIrC,EAAJ,CAAuB+B,EAAoBI,CAApBJ,CAAvB,IARd,CAxHH,GAuIlB/B,mBAAqBA,CAvI9B,CAAA,EAwIGsC,MAxIH,CAwIWT,SAxIX,CAwIsBpB,MAxItB"}